// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var $$Array = require("bs-platform/lib/js/array.js");
var Curry = require("bs-platform/lib/js/curry.js");
var React = require("react");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var Hook$GclAtom = require("./Hook.bs.js");
var Link$GclAtom = require("./Link.bs.js");
var Util$GclAtom = require("../Util/Util.bs.js");
var Syntax$GclAtom = require("../GCL/Syntax.bs.js");
var Caml_chrome_debugger = require("bs-platform/lib/js/caml_chrome_debugger.js");

function Expr$Paren(Props) {
  var activate = Props.activate;
  var children = Props.children;
  var match = Hook$GclAtom.useState(false);
  var setHover = match[1];
  var match$1 = Hook$GclAtom.useState(false);
  var setCollapse = match$1[1];
  var collapsed = match$1[0];
  var onMouseOver = function (param) {
    return Curry._1(setHover, true);
  };
  var onMouseLeave = function (param) {
    return Curry._1(setHover, false);
  };
  var onClick = function (param) {
    return Curry._1(setCollapse, collapsed ? false : true);
  };
  var className = "expr-paren" + ((
      match[0] ? " hovered" : ""
    ) + (
      collapsed ? " collapsed" : ""
    ));
  if (activate) {
    if (collapsed) {
      return React.createElement("div", {
                  className: className,
                  onClick: onClick,
                  onMouseLeave: onMouseLeave,
                  onMouseOver: onMouseOver
                }, "(...)");
    } else {
      return React.createElement(React.Fragment, undefined, React.createElement("div", {
                      className: className,
                      onClick: onClick,
                      onMouseLeave: onMouseLeave,
                      onMouseOver: onMouseOver
                    }, "("), children, React.createElement("div", {
                      className: className,
                      onClick: onClick,
                      onMouseLeave: onMouseLeave,
                      onMouseOver: onMouseOver
                    }, ")"));
    }
  } else {
    return children;
  }
}

var Paren = {
  make: Expr$Paren
};

function Expr$Space(Props) {
  return React.createElement("div", undefined, " ");
}

var Space = {
  make: Expr$Space
};

function Expr$Low(Props) {
  var value = Props.value;
  return React.createElement("div", undefined, Syntax$GclAtom.Lower.toString(value));
}

var Low = {
  make: Expr$Low
};

function Expr$Operator(Props) {
  var value = Props.value;
  var loc = Props.loc;
  return React.createElement(Link$GclAtom.make, {
              loc: loc,
              children: Syntax$GclAtom.Op.toString(value)
            });
}

var Operator = {
  make: Expr$Operator
};

function handleOperator(n, op, loc) {
  var makeProps = function (prim, prim$1, prim$2, prim$3) {
    var tmp = {
      prec: prim,
      value: prim$1
    };
    if (prim$2 !== undefined) {
      tmp.key = Caml_option.valFromOption(prim$2);
    }
    return tmp;
  };
  var match = Curry._1(Syntax$GclAtom.Expr.Precedence.classify, op);
  switch (match.tag | 0) {
    case /* InfixL */0 :
        var m = match[0];
        return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (p) {
                      return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (q) {
                                    return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                                    activate: n > m,
                                                    children: null
                                                  }, React.createElement(make, makeProps(m, p, undefined, /* () */0)), React.createElement(Expr$Space, { }), React.createElement(Expr$Operator, {
                                                        value: op,
                                                        loc: loc
                                                      }), React.createElement(Expr$Space, { }), React.createElement(make, makeProps(m + 1 | 0, q, undefined, /* () */0)))]);
                                  }));
                    }));
    case /* InfixR */1 :
        var m$1 = match[0];
        return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (p) {
                      return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (q) {
                                    return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                                    activate: n > m$1,
                                                    children: null
                                                  }, React.createElement(make, makeProps(m$1 + 1 | 0, p, undefined, /* () */0)), React.createElement(Expr$Space, { }), React.createElement(Expr$Operator, {
                                                        value: op,
                                                        loc: loc
                                                      }), React.createElement(Expr$Space, { }), React.createElement(make, makeProps(m$1, q, undefined, /* () */0)))]);
                                  }));
                    }));
    case /* Infix */2 :
        var m$2 = match[0];
        return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (p) {
                      return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (q) {
                                    return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                                    activate: n > m$2,
                                                    children: null
                                                  }, React.createElement(make, makeProps(m$2 + 1 | 0, p, undefined, /* () */0)), React.createElement(Expr$Space, { }), React.createElement(Expr$Operator, {
                                                        value: op,
                                                        loc: loc
                                                      }), React.createElement(Expr$Space, { }), React.createElement(make, makeProps(m$2 + 1 | 0, q, undefined, /* () */0)))]);
                                  }));
                    }));
    case /* Prefix */3 :
        var m$3 = match[0];
        return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (p) {
                      return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                      activate: n > m$3,
                                      children: null
                                    }, React.createElement(Expr$Operator, {
                                          value: op,
                                          loc: loc
                                        }), React.createElement(Expr$Space, { }), React.createElement(make, makeProps(m$3, p, undefined, /* () */0)))]);
                    }));
    case /* Postfix */4 :
        var m$4 = match[0];
        return Syntax$GclAtom.VarArg.let_(Syntax$GclAtom.VarArg.$$var, (function (p) {
                      return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                      activate: n > m$4,
                                      children: null
                                    }, React.createElement(make, makeProps(m$4, p, undefined, /* () */0)), React.createElement(Expr$Space, { }), React.createElement(Expr$Operator, {
                                          value: op,
                                          loc: loc
                                        }))]);
                    }));
    
  }
}

function handleExpr(n) {
  var makeProps = function (prim, prim$1, prim$2, prim$3) {
    var tmp = {
      prec: prim,
      value: prim$1
    };
    if (prim$2 !== undefined) {
      tmp.key = Caml_option.valFromOption(prim$2);
    }
    return tmp;
  };
  return (function (param) {
      switch (param.tag | 0) {
        case /* Var */0 :
        case /* Const */1 :
            break;
        case /* Lit */2 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$GclAtom.make, {
                            loc: param[1],
                            children: Syntax$GclAtom.Lit.toString(param[0])
                          })]);
        case /* Op */3 :
            return handleOperator(n, param[0], param[1]);
        case /* App */4 :
            var q = param[1];
            var match = handleExpr(n)(param[0]);
            if (match.tag) {
              var s = match[0];
              var match$1 = handleExpr(n)(q);
              if (match$1.tag) {
                var t = match$1[0];
                if (q.tag === /* App */4) {
                  return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(React.Fragment, undefined, s, React.createElement(Expr$Paren, {
                                      activate: true,
                                      children: t
                                    }))]);
                } else {
                  return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(React.Fragment, undefined, s, React.createElement(Expr$Space, { }), t)]);
                }
              } else {
                return /* Expect */Caml_chrome_debugger.variant("Expect", 0, [match$1[0]]);
              }
            } else {
              return Curry._1(match[0], q);
            }
        case /* Quant */5 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$GclAtom.make, {
                            loc: param[4],
                            children: null
                          }, "<", React.createElement(Expr$Space, { }), React.createElement(make, makeProps(0, param[0], undefined, /* () */0)), React.createElement(Expr$Space, { }), Util$GclAtom.React.sepBy(React.createElement(Expr$Space, { }), $$Array.map((function (value) {
                                      return React.createElement(Expr$Low, {
                                                  value: value
                                                });
                                    }), param[1])), React.createElement(Expr$Space, { }), ":", React.createElement(Expr$Space, { }), React.createElement(make, makeProps(0, param[2], undefined, /* () */0)), React.createElement(Expr$Space, { }), ":", React.createElement(Expr$Space, { }), React.createElement(make, makeProps(0, param[3], undefined, /* () */0)), React.createElement(Expr$Space, { }), ">")]);
        case /* Hole */6 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$GclAtom.make, {
                            loc: param[0],
                            children: "[?]"
                          })]);
        
      }
      return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$GclAtom.make, {
                      loc: param[1],
                      children: param[0]
                    })]);
    });
}

function make(Props) {
  var prec = Props.prec;
  var value = Props.value;
  var match = handleExpr(prec)(value);
  if (match.tag) {
    return match[0];
  } else {
    return React.createElement(React.Fragment, undefined);
  }
}

var Prec = {
  handleOperator: handleOperator,
  handleExpr: handleExpr,
  make: make
};

function Expr(Props) {
  var value = Props.value;
  return React.createElement("div", {
              className: "expr"
            }, React.createElement(make, {
                  prec: 0,
                  value: value
                }));
}

var make$1 = Expr;

exports.Paren = Paren;
exports.Space = Space;
exports.Low = Low;
exports.Operator = Operator;
exports.Prec = Prec;
exports.make = make$1;
/* react Not a pure module */
