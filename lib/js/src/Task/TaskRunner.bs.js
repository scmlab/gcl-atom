// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var $$Promise = require("reason-promise/lib/js/src/js/promise.js");
var P$GclAtom = require("../Util/P.bs.js");
var Belt_Array = require("bs-platform/lib/js/belt_Array.js");
var State$GclAtom = require("../State.bs.js");
var Task__Command$GclAtom = require("./Task__Command.bs.js");
var Task__Response$GclAtom = require("./Task__Response.bs.js");

function run(state, tasks) {
  var runTask = function (task) {
    switch (task.tag | 0) {
      case /* WithState */0 :
          return $$Promise.flatMap(Curry._1(task[0], state), (function (param) {
                        return run(state, param);
                      }));
      case /* SetSpecifications */1 :
          console.log("[ set specifications ]");
          state.specifications = task[0];
          return $$Promise.resolved(/* () */0);
      case /* AddDecorations */2 :
          console.log("[ add decorations ]");
          state.decorations = Belt_Array.concat(Curry._2(task[0], state.specifications, state.editor), state.decorations);
          return $$Promise.resolved(/* () */0);
      case /* DispatchCommand */3 :
          var command = task[0];
          console.log("[ dispatch command ]", command);
          return run(state, Task__Command$GclAtom.dispatch(command));
      case /* SendRequest */4 :
          console.log("[ send request ]");
          return $$Promise.flatMap(State$GclAtom.sendRequest(task[0], state), (function (param) {
                        if (param.tag) {
                          var match = State$GclAtom.$$Error.toString(param[0]);
                          State$GclAtom.displayError(match[0], match[1], state);
                          return $$Promise.resolved(/* () */0);
                        } else {
                          return run(state, Task__Response$GclAtom.handle(param[0]));
                        }
                      }));
      case /* Display */5 :
          Curry._1(state.view.setHeader, task[0]);
          Curry._1(state.view.setBody, task[1]);
          return $$Promise.resolved(/* () */0);
      
    }
  };
  var runEach = function (param) {
    if (param) {
      var xs = param[1];
      return P$GclAtom.let_(runTask(param[0]), (function (param) {
                    return P$GclAtom.let_(runEach(xs), (function (param) {
                                  return $$Promise.resolved(/* () */0);
                                }));
                  }));
    } else {
      return $$Promise.resolved(/* () */0);
    }
  };
  return runEach(tasks);
}

exports.run = run;
/* Promise Not a pure module */
